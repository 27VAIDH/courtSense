## Codebase Patterns
- Tailwind CSS v4 uses `@tailwindcss/vite` plugin ‚Äî no PostCSS/Autoprefixer config needed
- Tailwind v4 CSS import: `@import "tailwindcss";` in index.css
- Path alias `@/` maps to `src/` via both tsconfig.app.json and vite.config.ts
- TypeScript strict mode enabled in tsconfig.app.json
- Build command: `npm run build` (runs `tsc -b && vite build`)
- Dexie reactive hooks: use `dexie-react-hooks` package (separate from `dexie`)
- React Router DOM v7 installed (compatible with v6+ API)
- PWA: `vite-plugin-pwa` with `registerType: 'autoUpdate'` ‚Äî auto-registers SW and generates manifest
- App icons are SVG-based in `public/icons/` ‚Äî 192x192, 512x512, and apple-touch-icon
- iOS PWA meta tags in index.html: apple-mobile-web-app-capable, black-translucent status bar, viewport-fit=cover
- Dexie database in `src/db/database.ts` with name `squashiq-db` ‚Äî tables: players, venues, matches, games, rally_analyses
- TypeScript interfaces in `src/db/types.ts` ‚Äî Player, Venue, Match, Game, RallyAnalysis
- Reactive hooks in `src/db/hooks.ts` ‚Äî usePlayers(), useVenues(), useMatches(), useGames(matchId?), useRallyAnalyses(matchId?)
- Default current user auto-created via `ensureCurrentUser()` called in App.tsx useEffect
- Dexie indexed boolean fields: use `.equals(1)` not `.equals(true)` for boolean queries (Dexie stores booleans as 0/1)
- React Router: BrowserRouter wraps App in main.tsx, Routes in App.tsx
- Tab bar visibility: controlled by `useUIStore` Zustand store in `src/stores/uiStore.ts` ‚Äî call `hideTabBar()`/`showTabBar()`
- Page components live in `src/pages/` ‚Äî Dashboard, LogMatch, Timeline, Rivals, Profile
- Layout components live in `src/components/layout/` ‚Äî BottomTabBar
- Bottom tab bar uses `env(safe-area-inset-bottom)` for iOS safe area padding
- App root div has `pb-20` to prevent content from being hidden behind the fixed tab bar
- Tailwind v4 custom theme: use `@theme { --color-xyz: #hex; }` in index.css ‚Äî classes become `bg-xyz`, `text-xyz`, etc.
- UI components in `src/components/ui/` ‚Äî Card, Button, Chip (all with 48px min touch targets)
- Global `@media (prefers-reduced-motion: reduce)` in index.css disables all animations
- Feature components organized by domain: `src/components/opponents/`, `src/components/venues/`, etc.
- Modal pattern: bottom-sheet style with `fixed inset-0 z-50 flex items-end` and `rounded-t-[20px] bg-surface-elevated`
- Inline delete confirmation pattern: replace delete button with confirm/cancel buttons directly on the card
- Venue components in `src/components/venues/` ‚Äî same modal/card patterns as opponents

# Ralph Progress Log
Started: Sat Feb  7 16:50:52 IST 2026
---

## 2026-02-07 - US-001
- What was implemented: Full project scaffolding with Vite + React + TypeScript, all required dependencies installed
- Files changed: package.json, vite.config.ts, tsconfig.json, tsconfig.app.json, tsconfig.node.json, index.html, src/App.tsx, src/index.css, src/main.tsx, .gitignore
- **Learnings for future iterations:**
  - Tailwind CSS v4 does NOT need postcss.config.js or autoprefixer ‚Äî the `@tailwindcss/vite` plugin handles everything
  - `create-vite` v8 requires Node 20.19+ ‚Äî use v6.x for Node 20.12
  - The `ralph/` directory is a nested git repo ‚Äî don't try to stage it in the main repo
  - Need `@types/node` dev dependency for `path` import in vite.config.ts
---

## Iteration 1 - Sat Feb  7 17:30:35 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-1.log
---
US-001 is complete. There are still stories with `passes: false` (US-002 through US-041), so another iteration will pick up the next story.

**Summary of US-001 completion:**
- Scaffolded Vite + React + TypeScript project in the project root
- Installed all required dependencies: Tailwind CSS v4, Zustand, Dexie.js + dexie-react-hooks, Framer Motion, Recharts, html2canvas, React Router DOM
- Configured Tailwind CSS v4 with `@tailwindcss/vite` plugin
- Configured tsconfig with strict mode and `@/` path alias mapping to `src/`
- Build passes, dev server runs, typecheck passes
- Committed as `feat: US-001 - Project scaffolding with full tech stack`
- PRD updated with `passes: true` for US-001
- Progress log updated with codebase patterns and learnings
---

## 2026-02-07 - US-003
- What was implemented: Database schema, TypeScript types, and data hooks
- Files changed: src/db/types.ts (new), src/db/database.ts (new), src/db/hooks.ts (new), src/App.tsx (added ensureCurrentUser call)
- **Learnings for future iterations:**
  - Dexie stores boolean `true` as `1` in IndexedDB ‚Äî use `.equals(1)` for boolean indexed queries
  - `useLiveQuery` from `dexie-react-hooks` returns `undefined` while loading, not an empty array ‚Äî handle loading state in consumers
  - Dexie schema string format: `++id` for auto-increment, comma-separated indexed fields
  - `ensureCurrentUser()` is async and called in App useEffect ‚Äî it checks for existing current user before creating one
---

## 2026-02-07 - US-002
- What was implemented: PWA configuration for iOS home screen install
- Files changed: package.json (vite-plugin-pwa added), vite.config.ts (VitePWA plugin configured), index.html (iOS meta tags, viewport-fit=cover), public/icons/icon-192x192.svg, public/icons/icon-512x512.svg, public/icons/apple-touch-icon.svg
- **Learnings for future iterations:**
  - `vite-plugin-pwa` with `registerType: 'autoUpdate'` handles SW registration automatically ‚Äî no need to manually register in main.tsx
  - The plugin generates `manifest.webmanifest`, `registerSW.js`, and `sw.js` in the dist output
  - SVG icons work fine for PWA manifest icons ‚Äî no need for PNG conversion
  - Workbox `globPatterns` in the config controls which files get precached for offline use
  - The manifest is auto-injected into the HTML by the plugin ‚Äî no manual `<link rel="manifest">` needed
---

## Iteration 2 - Sat Feb  7 17:33:37 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-2.log
---
US-002 is complete. There are still stories with `passes: false` (US-003 through US-041), so another iteration will pick up the next story.

**Summary of US-002 completion:**
- Installed `vite-plugin-pwa` as dev dependency
- Configured `VitePWA` plugin in `vite.config.ts` with full manifest (name, short_name, display standalone, orientation portrait, theme/background colors #0A0A0A)
- Created SVG-based placeholder icons at 192x192, 512x512, and apple-touch-icon sizes in `public/icons/`
- Updated `index.html` with iOS PWA meta tags: `apple-mobile-web-app-capable`, `apple-mobile-web-app-status-bar-style=black-translucent`, `viewport-fit=cover`
- Service worker auto-registered with `registerType: 'autoUpdate'` ‚Äî caches app shell via Workbox with 11 precache entries
- Typecheck passes, build succeeds
- Committed as `feat: US-002 - PWA configuration for iOS home screen install`
- PRD updated with `passes: true` for US-002
- Progress log updated with codebase patterns and learnings
---

## Iteration 3 - Sat Feb  7 17:35:49 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-3.log
---
US-003 is complete. There are still stories with `passes: false` (US-004 through US-041), so another iteration will pick up the next story.

**Summary of US-003 completion:**
- Created `src/db/types.ts` with TypeScript interfaces: Player, Venue, Match, Game, RallyAnalysis
- Created `src/db/database.ts` with Dexie.js database `squashiq-db` and all 5 tables (players, venues, matches, games, rally_analyses) with proper schemas
- Created `src/db/hooks.ts` with reactive hooks using `useLiveQuery`: usePlayers(), useVenues(), useMatches(), useGames(matchId?), useRallyAnalyses(matchId?)
- Updated `src/App.tsx` to call `ensureCurrentUser()` on first load, which auto-creates a default current user player record
- Typecheck passes, build succeeds, lint clean
- Committed as `feat: US-003 - Database schema, TypeScript types, and data hooks`
- PRD updated with `passes: true` for US-003
- Progress log and codebase patterns updated
---

## 2026-02-07 - US-004
- What was implemented: App shell with bottom tab navigation ‚Äî 5-tab bottom bar, React Router routes, placeholder pages, Zustand-controlled tab bar visibility
- Files changed: src/App.tsx (rewrote with Routes + BottomTabBar), src/main.tsx (wrapped with BrowserRouter), src/stores/uiStore.ts (new), src/components/layout/BottomTabBar.tsx (new), src/pages/Dashboard.tsx (new), src/pages/LogMatch.tsx (new), src/pages/Timeline.tsx (new), src/pages/Rivals.tsx (new), src/pages/Profile.tsx (new)
- **Learnings for future iterations:**
  - NavLink from react-router-dom supports `end` prop for exact matching on `/` route
  - Use `env(safe-area-inset-bottom)` in inline style (not Tailwind) for iOS safe area ‚Äî Tailwind v4 doesn't include this by default
  - The center "Log" tab is visually distinct with a larger icon inside a circular background
  - Tab bar visibility is a simple boolean in Zustand ‚Äî call `hideTabBar()` when entering match logging flow
---

## Iteration 1 - Sat Feb  7 17:43:58 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-1.log
---
US-004 is complete. There are still stories with `passes: false` (US-005 through US-041), so another iteration will pick up the next story.

**Summary of US-004 completion:**
- Created `src/stores/uiStore.ts` ‚Äî Zustand store with `tabBarVisible`, `showTabBar()`, and `hideTabBar()` for controlling tab bar visibility (needed for match logging flow)
- Created `src/components/layout/BottomTabBar.tsx` ‚Äî 5-tab bottom nav bar (Dashboard, Timeline, Log, Rivals, Profile) with:
  - Log tab visually distinct: larger icon with circular accent-colored background (#00E676)
  - Active tab highlighted with primary color #00E676
  - Fixed to bottom with `env(safe-area-inset-bottom)` for iOS safe area
  - 48px minimum touch targets on all tabs
  - Controlled by Zustand store visibility flag
- Created 5 placeholder page components in `src/pages/`
- Updated `src/main.tsx` to wrap with `BrowserRouter`
- Updated `src/App.tsx` with React Router `Routes` for all 5 routes (`/`, `/log`, `/timeline`, `/rivals`, `/profile`) plus `BottomTabBar`
- Typecheck passes, build succeeds, lint clean
- Committed as `feat: US-004 - App shell with bottom tab navigation`
- PRD updated with `passes: true` for US-004
- Progress log and codebase patterns updated
---

## 2026-02-07 - US-005
- What was implemented: Dark theme design tokens via Tailwind CSS v4 @theme, global styles, and 3 reusable UI components (Card, Button, Chip)
- Files changed: src/index.css (added @theme colors, global styles, reduced-motion media query), src/components/ui/Card.tsx (new), src/components/ui/Button.tsx (new), src/components/ui/Chip.tsx (new)
- **Learnings for future iterations:**
  - Tailwind CSS v4 uses `@theme` directive in CSS to define custom colors ‚Äî no tailwind.config.ts needed
  - Custom color names in `@theme { --color-xyz }` become utility classes like `bg-xyz`, `text-xyz`, `border-xyz`
  - The `bg-surface`, `text-text-primary`, `text-text-secondary`, `bg-primary`, `text-win`, `text-loss`, `text-tight` classes are all available globally
  - Card component: `rounded-[16px] bg-surface p-4` ‚Äî accepts onClick for interactive cards
  - Button component: primary (green bg, black text) and secondary (surface bg, white text) variants
  - Chip component: selected state toggles between filled primary and outlined style
---

## Iteration 2 - Sat Feb  7 17:46:02 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-2.log
---
US-005 is complete. Here's what was implemented:

**US-005 - Dark theme, design tokens, and base UI components**

- **Design tokens** in `src/index.css` via Tailwind CSS v4 `@theme` directive: primary (#00E676), secondary (#448AFF), accent (#FF6D00), bg (#0A0A0A), surface (#1A1A1A), surface-elevated (#242424), text-primary (#FFFFFF), text-secondary (#B0B0B0), win (#00E676), loss (#FF5252), tight (#FFD600)
- **Global styles**: dark background, system font stack (system-ui/-apple-system/SF Pro), antialiased rendering
- **Reduced motion**: `@media (prefers-reduced-motion: reduce)` disables all animations globally
- **Card** (`src/components/ui/Card.tsx`): surface background, 16px border-radius, p-4 padding, optional onClick
- **Button** (`src/components/ui/Button.tsx`): primary (green) and secondary (surface) variants, 12px border-radius, 48px min height
- **Chip** (`src/components/ui/Chip.tsx`): 20px border-radius, selectable state (filled vs outlined), 48px min touch target

All checks pass (typecheck, build, lint). Committed as `feat: US-005 - Dark theme, design tokens, and base UI components`.

There are still stories with `passes: false` (US-006 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-006
- What was implemented: Opponent management ‚Äî add, edit, delete opponents on the Profile page
- Files changed: src/components/opponents/OpponentManager.tsx (new), src/pages/Profile.tsx (updated from placeholder)
- **Learnings for future iterations:**
  - Bottom-sheet modals: use `fixed inset-0 z-50` overlay with `items-end` flex to anchor modal to bottom
  - For delete confirmation, inline confirm/cancel buttons on the card work better than a separate dialog on mobile
  - `usePlayers()` returns undefined during loading ‚Äî filter and sort after null check
  - Opponents = players where `isCurrentUser === false`, sorted by `createdAt` descending
  - Emoji input with `maxLength={2}` accounts for emoji being 2 chars in some encodings
  - Profile page uses `pb-24` bottom padding to account for the fixed tab bar
---

## Iteration 3 - Sat Feb  7 17:47:59 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-3.log
---
US-006 is complete. Here's what was implemented:

**US-006 - Opponent management (add, edit, delete players)**

- **OpponentManager component** (`src/components/opponents/OpponentManager.tsx`): Full CRUD for opponents on the Profile page
  - **Add**: "Add Opponent" button opens a bottom-sheet modal with name + emoji inputs (emoji defaults to random sports emoji)
  - **List**: All non-current-user players displayed as cards with emoji + name, sorted by `createdAt` descending
  - **Edit**: Pencil icon on each card opens edit modal with pre-filled data
  - **Delete**: Trash icon shows inline confirm/cancel buttons before deleting
  - All operations use Dexie.js directly for immediate persistence
- **Profile page** (`src/pages/Profile.tsx`): Updated from placeholder to include the OpponentManager section
- All interactive elements have 48px minimum touch targets
- Typecheck passes, build succeeds

Committed as `feat: US-006 - Opponent management (add, edit, delete players)`.

There are still stories with `passes: false` (US-007 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-007
- What was implemented: Venue management ‚Äî add, edit, delete venues on the Profile page, below opponents section
- Files changed: src/components/venues/VenueManager.tsx (new), src/pages/Profile.tsx (updated to include VenueManager)
- **Learnings for future iterations:**
  - VenueManager follows the exact same UX pattern as OpponentManager: bottom-sheet modal, inline delete confirmation
  - Toggle/switch for boolean fields (isHome): use a styled `<button role="switch">` with `aria-checked` for accessibility
  - "Home" badge uses `bg-primary/20 text-primary` pill style to indicate home court status
  - Venues use a üìç pin emoji as the fixed icon instead of user-selected emojis
  - The `useVenues()` hook returns all venues; sort by `createdAt` descending in the component
---
