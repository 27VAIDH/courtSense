## Codebase Patterns
- Tailwind CSS v4 uses `@tailwindcss/vite` plugin ‚Äî no PostCSS/Autoprefixer config needed
- Tailwind v4 CSS import: `@import "tailwindcss";` in index.css
- Path alias `@/` maps to `src/` via both tsconfig.app.json and vite.config.ts
- TypeScript strict mode enabled in tsconfig.app.json
- Build command: `npm run build` (runs `tsc -b && vite build`)
- Dexie reactive hooks: use `dexie-react-hooks` package (separate from `dexie`)
- React Router DOM v7 installed (compatible with v6+ API)
- PWA: `vite-plugin-pwa` with `registerType: 'autoUpdate'` ‚Äî auto-registers SW and generates manifest
- App icons are SVG-based in `public/icons/` ‚Äî 192x192, 512x512, and apple-touch-icon
- iOS PWA meta tags in index.html: apple-mobile-web-app-capable, black-translucent status bar, viewport-fit=cover
- Dexie database in `src/db/database.ts` with name `squashiq-db` ‚Äî tables: players, venues, matches, games, rally_analyses
- TypeScript interfaces in `src/db/types.ts` ‚Äî Player, Venue, Match, Game, RallyAnalysis
- Reactive hooks in `src/db/hooks.ts` ‚Äî usePlayers(), useVenues(), useMatches(), useGames(matchId?), useRallyAnalyses(matchId?)
- Default current user auto-created via `ensureCurrentUser()` called in App.tsx useEffect
- Dexie indexed boolean fields: use `.equals(1)` not `.equals(true)` for boolean queries (Dexie stores booleans as 0/1)
- React Router: BrowserRouter wraps App in main.tsx, Routes in App.tsx
- Tab bar visibility: controlled by `useUIStore` Zustand store in `src/stores/uiStore.ts` ‚Äî call `hideTabBar()`/`showTabBar()`
- Page components live in `src/pages/` ‚Äî Dashboard, LogMatch, Timeline, Rivals, Profile
- Layout components live in `src/components/layout/` ‚Äî BottomTabBar
- Bottom tab bar uses `env(safe-area-inset-bottom)` for iOS safe area padding
- App root div has `pb-20` to prevent content from being hidden behind the fixed tab bar
- Tailwind v4 custom theme: use `@theme { --color-xyz: #hex; }` in index.css ‚Äî classes become `bg-xyz`, `text-xyz`, etc.
- UI components in `src/components/ui/` ‚Äî Card, Button, Chip (all with 48px min touch targets)
- Global `@media (prefers-reduced-motion: reduce)` in index.css disables all animations
- Feature components organized by domain: `src/components/opponents/`, `src/components/venues/`, etc.
- Modal pattern: bottom-sheet style with `fixed inset-0 z-50 flex items-end` and `rounded-t-[20px] bg-surface-elevated`
- Inline delete confirmation pattern: replace delete button with confirm/cancel buttons directly on the card
- Venue components in `src/components/venues/` ‚Äî same modal/card patterns as opponents
- Match logging state: Zustand store in `src/stores/matchLogStore.ts` ‚Äî persists selections across steps 1-3
- Match logging components in `src/components/matchlog/` ‚Äî StepIndicator, StepSetup (Step 1)
- LogMatch page is full-screen (fixed inset-0 z-40) with tab bar hidden via useUIStore
- Match logging flow uses `reset()` on exit to clear all state
- Exit confirmation dialog shown only if user has made selections (hasSelection check)
- Score entry: `GameScore` type from matchLogStore, tight game = both scores >= 8, quick presets as tappable pills
- Match result auto-calculated: count games where myScore > opponentScore vs opposite
- Match save writes to both `matches` and `games` tables ‚Äî use `db.games.bulkAdd()` for batch insert
- Post-match save screen at route `/match/:id/saved` ‚Äî tab bar hidden, shows confirmation with animations
- StepTagsSave component handles all step 3 UI + save logic ‚Äî save button is inside the component, not in LogMatch bottom bar
- canvas-confetti library for win celebrations ‚Äî fire from both sides with custom colors
- PostMatchSaved reads match/games/opponent from Dexie via useParams matchId ‚Äî uses useMemo for derived data
- Streak detection: filter matches by opponentId, count consecutive same-result matches from most recent
- Match list components in `src/components/matches/` ‚Äî MatchHistoryList renders sorted match cards with game scores
- Match detail route: `/match/:id` renders MatchDetail page with full detail, edit, and delete
- Match edit: inline edit mode in MatchDetail page ‚Äî score editing with +/- buttons and presets, tags/vibe/energy/note editing, save overwrites existing records
- Match delete: deletes both match + game records via `db.games.where('matchId').equals(id).delete()` then `db.matches.delete(id)`
- `useGames()` without matchId returns ALL games ‚Äî use Map<matchId, Game[]> for efficient lookup in list views
- Relative date formatting: "Today", "Yesterday", then "Mon Jan 6" style for older dates

# Ralph Progress Log
Started: Sat Feb  7 16:50:52 IST 2026
---

## 2026-02-07 - US-001
- What was implemented: Full project scaffolding with Vite + React + TypeScript, all required dependencies installed
- Files changed: package.json, vite.config.ts, tsconfig.json, tsconfig.app.json, tsconfig.node.json, index.html, src/App.tsx, src/index.css, src/main.tsx, .gitignore
- **Learnings for future iterations:**
  - Tailwind CSS v4 does NOT need postcss.config.js or autoprefixer ‚Äî the `@tailwindcss/vite` plugin handles everything
  - `create-vite` v8 requires Node 20.19+ ‚Äî use v6.x for Node 20.12
  - The `ralph/` directory is a nested git repo ‚Äî don't try to stage it in the main repo
  - Need `@types/node` dev dependency for `path` import in vite.config.ts
---

## Iteration 1 - Sat Feb  7 17:30:35 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-1.log
---
US-001 is complete. There are still stories with `passes: false` (US-002 through US-041), so another iteration will pick up the next story.

**Summary of US-001 completion:**
- Scaffolded Vite + React + TypeScript project in the project root
- Installed all required dependencies: Tailwind CSS v4, Zustand, Dexie.js + dexie-react-hooks, Framer Motion, Recharts, html2canvas, React Router DOM
- Configured Tailwind CSS v4 with `@tailwindcss/vite` plugin
- Configured tsconfig with strict mode and `@/` path alias mapping to `src/`
- Build passes, dev server runs, typecheck passes
- Committed as `feat: US-001 - Project scaffolding with full tech stack`
- PRD updated with `passes: true` for US-001
- Progress log updated with codebase patterns and learnings
---

## 2026-02-07 - US-003
- What was implemented: Database schema, TypeScript types, and data hooks
- Files changed: src/db/types.ts (new), src/db/database.ts (new), src/db/hooks.ts (new), src/App.tsx (added ensureCurrentUser call)
- **Learnings for future iterations:**
  - Dexie stores boolean `true` as `1` in IndexedDB ‚Äî use `.equals(1)` for boolean indexed queries
  - `useLiveQuery` from `dexie-react-hooks` returns `undefined` while loading, not an empty array ‚Äî handle loading state in consumers
  - Dexie schema string format: `++id` for auto-increment, comma-separated indexed fields
  - `ensureCurrentUser()` is async and called in App useEffect ‚Äî it checks for existing current user before creating one
---

## 2026-02-07 - US-002
- What was implemented: PWA configuration for iOS home screen install
- Files changed: package.json (vite-plugin-pwa added), vite.config.ts (VitePWA plugin configured), index.html (iOS meta tags, viewport-fit=cover), public/icons/icon-192x192.svg, public/icons/icon-512x512.svg, public/icons/apple-touch-icon.svg
- **Learnings for future iterations:**
  - `vite-plugin-pwa` with `registerType: 'autoUpdate'` handles SW registration automatically ‚Äî no need to manually register in main.tsx
  - The plugin generates `manifest.webmanifest`, `registerSW.js`, and `sw.js` in the dist output
  - SVG icons work fine for PWA manifest icons ‚Äî no need for PNG conversion
  - Workbox `globPatterns` in the config controls which files get precached for offline use
  - The manifest is auto-injected into the HTML by the plugin ‚Äî no manual `<link rel="manifest">` needed
---

## Iteration 2 - Sat Feb  7 17:33:37 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-2.log
---
US-002 is complete. There are still stories with `passes: false` (US-003 through US-041), so another iteration will pick up the next story.

**Summary of US-002 completion:**
- Installed `vite-plugin-pwa` as dev dependency
- Configured `VitePWA` plugin in `vite.config.ts` with full manifest (name, short_name, display standalone, orientation portrait, theme/background colors #0A0A0A)
- Created SVG-based placeholder icons at 192x192, 512x512, and apple-touch-icon sizes in `public/icons/`
- Updated `index.html` with iOS PWA meta tags: `apple-mobile-web-app-capable`, `apple-mobile-web-app-status-bar-style=black-translucent`, `viewport-fit=cover`
- Service worker auto-registered with `registerType: 'autoUpdate'` ‚Äî caches app shell via Workbox with 11 precache entries
- Typecheck passes, build succeeds
- Committed as `feat: US-002 - PWA configuration for iOS home screen install`
- PRD updated with `passes: true` for US-002
- Progress log updated with codebase patterns and learnings
---

## Iteration 3 - Sat Feb  7 17:35:49 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-172604/iter-3.log
---
US-003 is complete. There are still stories with `passes: false` (US-004 through US-041), so another iteration will pick up the next story.

**Summary of US-003 completion:**
- Created `src/db/types.ts` with TypeScript interfaces: Player, Venue, Match, Game, RallyAnalysis
- Created `src/db/database.ts` with Dexie.js database `squashiq-db` and all 5 tables (players, venues, matches, games, rally_analyses) with proper schemas
- Created `src/db/hooks.ts` with reactive hooks using `useLiveQuery`: usePlayers(), useVenues(), useMatches(), useGames(matchId?), useRallyAnalyses(matchId?)
- Updated `src/App.tsx` to call `ensureCurrentUser()` on first load, which auto-creates a default current user player record
- Typecheck passes, build succeeds, lint clean
- Committed as `feat: US-003 - Database schema, TypeScript types, and data hooks`
- PRD updated with `passes: true` for US-003
- Progress log and codebase patterns updated
---

## 2026-02-07 - US-004
- What was implemented: App shell with bottom tab navigation ‚Äî 5-tab bottom bar, React Router routes, placeholder pages, Zustand-controlled tab bar visibility
- Files changed: src/App.tsx (rewrote with Routes + BottomTabBar), src/main.tsx (wrapped with BrowserRouter), src/stores/uiStore.ts (new), src/components/layout/BottomTabBar.tsx (new), src/pages/Dashboard.tsx (new), src/pages/LogMatch.tsx (new), src/pages/Timeline.tsx (new), src/pages/Rivals.tsx (new), src/pages/Profile.tsx (new)
- **Learnings for future iterations:**
  - NavLink from react-router-dom supports `end` prop for exact matching on `/` route
  - Use `env(safe-area-inset-bottom)` in inline style (not Tailwind) for iOS safe area ‚Äî Tailwind v4 doesn't include this by default
  - The center "Log" tab is visually distinct with a larger icon inside a circular background
  - Tab bar visibility is a simple boolean in Zustand ‚Äî call `hideTabBar()` when entering match logging flow
---

## Iteration 1 - Sat Feb  7 17:43:58 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-1.log
---
US-004 is complete. There are still stories with `passes: false` (US-005 through US-041), so another iteration will pick up the next story.

**Summary of US-004 completion:**
- Created `src/stores/uiStore.ts` ‚Äî Zustand store with `tabBarVisible`, `showTabBar()`, and `hideTabBar()` for controlling tab bar visibility (needed for match logging flow)
- Created `src/components/layout/BottomTabBar.tsx` ‚Äî 5-tab bottom nav bar (Dashboard, Timeline, Log, Rivals, Profile) with:
  - Log tab visually distinct: larger icon with circular accent-colored background (#00E676)
  - Active tab highlighted with primary color #00E676
  - Fixed to bottom with `env(safe-area-inset-bottom)` for iOS safe area
  - 48px minimum touch targets on all tabs
  - Controlled by Zustand store visibility flag
- Created 5 placeholder page components in `src/pages/`
- Updated `src/main.tsx` to wrap with `BrowserRouter`
- Updated `src/App.tsx` with React Router `Routes` for all 5 routes (`/`, `/log`, `/timeline`, `/rivals`, `/profile`) plus `BottomTabBar`
- Typecheck passes, build succeeds, lint clean
- Committed as `feat: US-004 - App shell with bottom tab navigation`
- PRD updated with `passes: true` for US-004
- Progress log and codebase patterns updated
---

## 2026-02-07 - US-005
- What was implemented: Dark theme design tokens via Tailwind CSS v4 @theme, global styles, and 3 reusable UI components (Card, Button, Chip)
- Files changed: src/index.css (added @theme colors, global styles, reduced-motion media query), src/components/ui/Card.tsx (new), src/components/ui/Button.tsx (new), src/components/ui/Chip.tsx (new)
- **Learnings for future iterations:**
  - Tailwind CSS v4 uses `@theme` directive in CSS to define custom colors ‚Äî no tailwind.config.ts needed
  - Custom color names in `@theme { --color-xyz }` become utility classes like `bg-xyz`, `text-xyz`, `border-xyz`
  - The `bg-surface`, `text-text-primary`, `text-text-secondary`, `bg-primary`, `text-win`, `text-loss`, `text-tight` classes are all available globally
  - Card component: `rounded-[16px] bg-surface p-4` ‚Äî accepts onClick for interactive cards
  - Button component: primary (green bg, black text) and secondary (surface bg, white text) variants
  - Chip component: selected state toggles between filled primary and outlined style
---

## Iteration 2 - Sat Feb  7 17:46:02 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-2.log
---
US-005 is complete. Here's what was implemented:

**US-005 - Dark theme, design tokens, and base UI components**

- **Design tokens** in `src/index.css` via Tailwind CSS v4 `@theme` directive: primary (#00E676), secondary (#448AFF), accent (#FF6D00), bg (#0A0A0A), surface (#1A1A1A), surface-elevated (#242424), text-primary (#FFFFFF), text-secondary (#B0B0B0), win (#00E676), loss (#FF5252), tight (#FFD600)
- **Global styles**: dark background, system font stack (system-ui/-apple-system/SF Pro), antialiased rendering
- **Reduced motion**: `@media (prefers-reduced-motion: reduce)` disables all animations globally
- **Card** (`src/components/ui/Card.tsx`): surface background, 16px border-radius, p-4 padding, optional onClick
- **Button** (`src/components/ui/Button.tsx`): primary (green) and secondary (surface) variants, 12px border-radius, 48px min height
- **Chip** (`src/components/ui/Chip.tsx`): 20px border-radius, selectable state (filled vs outlined), 48px min touch target

All checks pass (typecheck, build, lint). Committed as `feat: US-005 - Dark theme, design tokens, and base UI components`.

There are still stories with `passes: false` (US-006 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-006
- What was implemented: Opponent management ‚Äî add, edit, delete opponents on the Profile page
- Files changed: src/components/opponents/OpponentManager.tsx (new), src/pages/Profile.tsx (updated from placeholder)
- **Learnings for future iterations:**
  - Bottom-sheet modals: use `fixed inset-0 z-50` overlay with `items-end` flex to anchor modal to bottom
  - For delete confirmation, inline confirm/cancel buttons on the card work better than a separate dialog on mobile
  - `usePlayers()` returns undefined during loading ‚Äî filter and sort after null check
  - Opponents = players where `isCurrentUser === false`, sorted by `createdAt` descending
  - Emoji input with `maxLength={2}` accounts for emoji being 2 chars in some encodings
  - Profile page uses `pb-24` bottom padding to account for the fixed tab bar
---

## Iteration 3 - Sat Feb  7 17:47:59 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-3.log
---
US-006 is complete. Here's what was implemented:

**US-006 - Opponent management (add, edit, delete players)**

- **OpponentManager component** (`src/components/opponents/OpponentManager.tsx`): Full CRUD for opponents on the Profile page
  - **Add**: "Add Opponent" button opens a bottom-sheet modal with name + emoji inputs (emoji defaults to random sports emoji)
  - **List**: All non-current-user players displayed as cards with emoji + name, sorted by `createdAt` descending
  - **Edit**: Pencil icon on each card opens edit modal with pre-filled data
  - **Delete**: Trash icon shows inline confirm/cancel buttons before deleting
  - All operations use Dexie.js directly for immediate persistence
- **Profile page** (`src/pages/Profile.tsx`): Updated from placeholder to include the OpponentManager section
- All interactive elements have 48px minimum touch targets
- Typecheck passes, build succeeds

Committed as `feat: US-006 - Opponent management (add, edit, delete players)`.

There are still stories with `passes: false` (US-007 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-007
- What was implemented: Venue management ‚Äî add, edit, delete venues on the Profile page, below opponents section
- Files changed: src/components/venues/VenueManager.tsx (new), src/pages/Profile.tsx (updated to include VenueManager)
- **Learnings for future iterations:**
  - VenueManager follows the exact same UX pattern as OpponentManager: bottom-sheet modal, inline delete confirmation
  - Toggle/switch for boolean fields (isHome): use a styled `<button role="switch">` with `aria-checked` for accessibility
  - "Home" badge uses `bg-primary/20 text-primary` pill style to indicate home court status
  - Venues use a üìç pin emoji as the fixed icon instead of user-selected emojis
  - The `useVenues()` hook returns all venues; sort by `createdAt` descending in the component
---

## Iteration 4 - Sat Feb  7 17:50:57 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-4.log
---
US-007 is complete. Here's what was implemented:

**US-007 - Venue management (add, edit, delete venues)**

- **VenueManager component** (`src/components/venues/VenueManager.tsx`): Full CRUD for venues on the Profile page, following the same UX patterns as OpponentManager
  - **Add**: "Add Venue" button opens a bottom-sheet modal with venue name input + Home Court toggle switch
  - **List**: All venues displayed as cards with üìç icon + name + "Home" badge (if `isHome=true`), sorted by `createdAt` descending
  - **Edit**: Pencil icon opens edit modal with pre-filled name and toggle state
  - **Delete**: Trash icon shows inline confirm/cancel buttons before deleting
  - Home Court toggle uses an accessible `role="switch"` button with `aria-checked`
- **Profile page** (`src/pages/Profile.tsx`): Updated to include VenueManager section below opponents with `mt-8` spacing
- Typecheck passes, build succeeds
- Committed as `feat: US-007 - Venue management (add, edit, delete venues)`

There are still stories with `passes: false` (US-008 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-008
- What was implemented: Match logging Step 1 (Setup screen) ‚Äî full-screen logging flow with opponent picker, date/time selector, venue picker, format toggle, exit confirmation
- Files changed: src/stores/matchLogStore.ts (new), src/components/matchlog/StepIndicator.tsx (new), src/components/matchlog/StepSetup.tsx (new), src/pages/LogMatch.tsx (rewritten)
- **Learnings for future iterations:**
  - Match logging state lives in Zustand store `useMatchLogStore` ‚Äî persists across steps 1-3, reset on exit
  - LogMatch page is `fixed inset-0 z-40` to cover the entire screen including tab bar area
  - Tab bar hidden/shown via `useUIStore` in useEffect with cleanup on unmount
  - Inline add-opponent/venue modals in StepSetup reuse the same bottom-sheet pattern from OpponentManager/VenueManager
  - Date picker trick: invisible datetime-local input overlaid on a styled button for native date picker
  - Format change adjusts games array length (3 for Bo3, 5 for Bo5) in the store
  - Exit confirmation only shows if `hasSelection` is true (opponentId !== null)
  - Steps 2 and 3 have placeholder content ‚Äî will be implemented in US-009 and US-010
---

## Iteration 5 - Sat Feb  7 17:54:05 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-174057/iter-5.log
---
US-008 is complete. There are still stories with `passes: false` (US-009 through US-041), so another iteration will pick up the next story.

**Summary of US-008 completion:**

- **Zustand store** (`src/stores/matchLogStore.ts`): Match logging state management with all fields for steps 1-3 (opponent, date, venue, format, games, energy, vibe, tags, note), step navigation, and `reset()` for cleanup
- **StepIndicator** (`src/components/matchlog/StepIndicator.tsx`): Shows "X of 3" with colored progress dots
- **StepSetup** (`src/components/matchlog/StepSetup.tsx`): Step 1 with:
  - **Opponent Picker**: horizontal scrollable Chip row with emoji + name, tap to select/deselect, "+" chip opens inline add-opponent modal
  - **Date/Time**: auto-filled with current date/time, displayed as tappable pill ("Today, 7:30 PM"), opens native datetime-local input on tap
  - **Venue Picker**: horizontal scrollable Chip row with üìç + name, "+" chip opens inline add-venue modal
  - **Format Selector**: segmented toggle between "Best of 3" and "Best of 5" (default Bo3)
- **LogMatch page** (`src/pages/LogMatch.tsx`): Full-screen logging flow with:
  - Tab bar hidden on mount, restored on unmount
  - Close "‚úï" button with exit confirmation dialog if selections were made
  - "Next" button disabled until opponent is selected
  - Placeholder content for steps 2 and 3
- Typecheck passes, build succeeds
- Committed as `feat: US-008 - Match logging ‚Äî Step 1 (Setup screen)`
---

## 2026-02-07 - US-009
- What was implemented: Match logging Step 2 (Score entry) ‚Äî vertical stack of game cards with +/- score buttons, quick score presets, tight game indicator, auto-calculated match result banner, collapsible unneeded games
- Files changed: src/components/matchlog/StepScoreEntry.tsx (new), src/pages/LogMatch.tsx (updated to use StepScoreEntry)
- **Learnings for future iterations:**
  - `GameScore` type exported from matchLogStore for reuse in components
  - Tight game detection: both scores >= 8 shows flame emoji on game card
  - Match result auto-calculated from game wins (myScore > opponentScore counts as game win)
  - Quick score presets use highlight style when current score matches: `border-primary bg-primary/20 text-primary`
  - Collapsible games: when match is decided (enough wins), unplayed games show "Not needed" in dimmed state
  - Score buttons use `min-h-[48px] min-w-[48px]` for large tap targets on mobile
  - The opponent name is fetched via `usePlayers()` hook and matched by `opponentId` from the store
---

## Iteration 1 - Sat Feb  7 17:59:44 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-175709/iter-1.log
---
US-009 is complete. Here's what was implemented:

**US-009 - Match logging ‚Äî Step 2 (Score entry)**

- **StepScoreEntry component** (`src/components/matchlog/StepScoreEntry.tsx`): Full score entry UI with:
  - **Match Result Banner**: Auto-calculated "WIN 3-1" (green) or "LOSS 1-3" (red) that updates in real-time as scores change
  - **Game Cards**: Vertical stack of 3 (Bo3) or 5 (Bo5) cards, each showing:
    - "Game N" label with fire emoji for tight games (both scores >= 8)
    - Two large score displays ("You" vs opponent name) with +/- buttons (48px min touch targets)
  - **Quick Score Presets**: Tappable pills below each game card ‚Äî 11-0, 11-5, 11-8, 11-9 ‚Äî with highlight when matching current score
  - **Collapsible Games**: When match is decided (enough wins), unplayed games show dimmed "Not needed" state
  - **Opponent Name**: Fetched from Dexie via `usePlayers()` hook, matched by `opponentId`
- **LogMatch page** (`src/pages/LogMatch.tsx`): Updated to render `StepScoreEntry` for step 2, replacing the placeholder. Back/Next buttons already handle step 2 navigation.
- Typecheck passes, build succeeds
- Committed as `feat: US-009 - Match logging ‚Äî Step 2 (Score entry)`

There are still stories with `passes: false` (US-010 through US-041), so another iteration will pick up the next story.
---

## 2026-02-07 - US-010
- What was implemented: Match logging Step 3 (Quick tags & save) ‚Äî energy level selector, match vibe picker, quick tags, match note, save to Dexie DB, post-match save screen
- Files changed: src/components/matchlog/StepTagsSave.tsx (new), src/pages/PostMatchSaved.tsx (new), src/pages/LogMatch.tsx (updated step 3 + bottom nav), src/App.tsx (added /match/:id/saved route), scripts/ralph/prd.json (US-010 passes: true)
- **Learnings for future iterations:**
  - Save button lives inside StepTagsSave component (not in LogMatch bottom bar) ‚Äî step 3 bottom bar only shows "Back"
  - Match save writes to `matches` table then `db.games.bulkAdd()` for all played game records
  - Result string format: "W 3-1" or "L 1-3" ‚Äî calculated from game scores
  - Only games with scores > 0 are saved (filters out unplayed games in Bo5 when match ends early)
  - Post-match save navigates to `/match/:id/saved` with `replace: true` so back button doesn't return to the log flow
  - `isTight` on game records: both scores >= 8
  - Optional fields (energyLevel, vibe, tags, note) saved as `undefined` when not set ‚Äî Dexie handles this gracefully
---

## Iteration 2 - Sat Feb  7 18:03:22 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-175709/iter-2.log
---
US-010 is complete. There are still stories with `passes: false` (US-011 through US-041), so another iteration will pick up the next story.

**Summary of US-010 completion:**

- **StepTagsSave component** (`src/components/matchlog/StepTagsSave.tsx`): Full Step 3 UI with:
  - **Energy Level**: 3 tappable icons (Low/Medium/High) with toggle on/off, single-select
  - **Match Vibe**: horizontal scrollable Chip row (Intense, Casual, Frustrating, Focused, Fun, Grind), single-select with toggle off
  - **Quick Tags**: flex-wrap grid of Chip components (Good day, Off day, New strategy, Comeback, Dominated, Lucky win, Close), multi-select toggle
  - **Match Note**: single-line text input with 140 char max, character counter
  - **Save Match button**: large green button that saves to Dexie DB
- **Save logic**: Creates match record in `matches` table with all data from steps 1-3, creates game records in `games` table for each played game via `bulkAdd()`, auto-calculates result as "W X-Y" or "L X-Y"
- **Post-match screen** (`src/pages/PostMatchSaved.tsx`): Simple confirmation page at `/match/:id/saved` with tab bar hidden, "Done" button returns to Dashboard (US-011 will build the full experience with animations)
- **LogMatch page updated**: Step 3 now shows `StepTagsSave` instead of placeholder, bottom bar shows only "Back" button on step 3
- Typecheck passes, build succeeds
- Committed as `feat: US-010 - Match logging ‚Äî Step 3 (Quick tags & save)`
---

## 2026-02-07 - US-011
- What was implemented: Post-match save experience with win confetti, loss blue pulse animation, streak toast, result display with opponent name, rally analysis placeholder
- Files changed: src/pages/PostMatchSaved.tsx (rewritten), package.json (canvas-confetti added)
- **Learnings for future iterations:**
  - `canvas-confetti` library works well for celebratory particle effects ‚Äî fire from both x:0 and x:1 origins for dual-sided burst
  - `navigator.vibrate(200)` for haptic feedback on win ‚Äî check availability first
  - Streak detection: sort opponent matches by recency, count consecutive wins/losses from most recent
  - Framer Motion `motion.div` with spring animations for bouncy emoji entrance, staggered delays for sequential reveals
  - CSS `@keyframes` in `<style>` tag for loss pulse animation ‚Äî respects `prefers-reduced-motion`
  - `useRef` with `confettiFired` flag prevents re-firing confetti on re-renders
  - Match data loaded via `useParams` matchId + Dexie hooks (useMatches, usePlayers, useGames)
---

## Iteration 3 - Sat Feb  7 18:06:03 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-175709/iter-3.log
---
US-011 is complete. There are still stories with `passes: false` (US-012 through US-041), so another iteration will pick up the next story.

**Summary of US-011 completion:**

- **Rewrote `src/pages/PostMatchSaved.tsx`** with full post-match experience:
  - **Win animation**: `canvas-confetti` burst from both sides with custom colors (#00E676, #448AFF, #FF6D00, #FFD600) + `navigator.vibrate(200)` haptic feedback
  - **Loss animation**: subtle blue pulse background animation (`rgba(68, 138, 255, 0.06)` pulsing at 3s intervals), empathetic not mocking
  - **Result display**: large animated emoji (üèÜ win / üí™ loss) with spring bounce, "WIN 3-1" or "LOSS 1-3" text colored green/red, opponent name + emoji, individual game scores
  - **Streak Toast**: detects consecutive wins/losses against the same opponent ‚Äî shows "W3 against Parth!" or "First win against Parth!" or "L2 ‚Äî time to turn it around!"
  - **Rally Analysis Placeholder**: "Want to add rally details? (30 sec)" link text (placeholder for US-029)
  - **Done button**: navigates back to Dashboard with tab bar restored
- **Framer Motion** staggered animations: emoji springs in, result fades up, opponent name slides in, streak toast scales in
- **Accessibility**: `@media (prefers-reduced-motion: reduce)` disables pulse animation
- **canvas-confetti** installed as new dependency
- Typecheck passes, build succeeds
- Committed as `feat: US-011 - Post-match save experience with animations`
---

## 2026-02-07 - US-012
- What was implemented: Match history list on Dashboard ‚Äî chronological match cards with opponent info, result, venue, game scores, tight game indicators, loading skeletons, empty state, and navigation to match detail
- Files changed: src/components/matches/MatchHistoryList.tsx (new), src/pages/Dashboard.tsx (updated from placeholder), src/pages/MatchDetail.tsx (new placeholder for US-013), src/App.tsx (added /match/:id route)
- **Learnings for future iterations:**
  - `useGames()` without matchId returns ALL games ‚Äî build a Map<matchId, Game[]> for efficient per-match lookup in list views
  - `useLiveQuery` returns `undefined` while loading ‚Äî show skeleton placeholders during this state
  - Match cards are tappable Cards that navigate to `/match/:id` ‚Äî detail view is a placeholder until US-013
  - Relative date formatting: compare day difference for "Today"/"Yesterday", then fall back to locale date string
  - Game scores displayed inline with flame emoji for tight games (isTight=true)
  - Matches sorted by `createdAt` descending (newest first)
---

## Iteration 4 - Sat Feb  7 18:08:35 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-175709/iter-4.log
---
US-012 is complete. There are still stories with `passes: false` (US-013 through US-041), so another iteration will pick up the next story.

**Summary of US-012 completion:**

- **MatchHistoryList component** (`src/components/matches/MatchHistoryList.tsx`): Displays all matches as tappable cards sorted by `createdAt` descending (newest first), each showing:
  - Opponent emoji + name
  - Relative date ("Today", "Yesterday", "Mon Jan 6")
  - Result text ("W 3-1" / "L 1-3") colored green for win / red for loss
  - Venue name in muted text
  - Individual game scores with flame emoji for tight games (isTight=true)
  - **Loading state**: 3 skeleton placeholder cards with pulse animation
  - **Empty state**: "No matches yet" with racket emoji and green CTA button linking to /log
  - Tapping a card navigates to `/match/:id`
- **Dashboard page** (`src/pages/Dashboard.tsx`): Updated from placeholder to show "Match History" header + MatchHistoryList
- **MatchDetail page** (`src/pages/MatchDetail.tsx`): Placeholder for US-013, with back navigation
- **App.tsx**: Added `/match/:id` route for match detail navigation
- Uses Dexie `useLiveQuery` hooks for reactive updates when new matches are saved
- Typecheck passes, build succeeds
- Committed as `feat: US-012 - Match history list`
---

## 2026-02-07 - US-013
- What was implemented: Full match detail view with read-only display of all match data, inline edit mode for scores/tags/vibe/energy/note, and delete with confirmation dialog
- Files changed: src/pages/MatchDetail.tsx (rewritten from placeholder)
- **Learnings for future iterations:**
  - Edit mode in match detail uses local component state (not Zustand store) since it's a self-contained form ‚Äî no need to pollute the global match log store
  - When editing game scores, delete all existing game records and re-create via `db.games.where('matchId').equals(id).delete()` + `db.games.bulkAdd()` ‚Äî simpler than trying to update individual records
  - `db.matches.update(id, { ...fields })` for partial match record updates ‚Äî Dexie merges the update with existing record
  - Match result string recalculated during edit save ‚Äî ensures consistency if scores change
  - The `Chip` and `Button` components from `src/components/ui/` are reusable across both the log flow and detail edit mode
  - Loading state with skeleton placeholders prevents flash of "not found" while Dexie queries resolve
  - Game scores in read-only view colored green/red based on who won each individual game
---

## Iteration 5 - Sat Feb  7 18:13:32 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/fun-projects/courtSense/scripts/ralph/runs/20260207-175709/iter-5.log
---
US-013 is complete. There are still stories with `passes: false` (US-014 through US-041), so another iteration will pick up the next story.

**Summary of US-013 completion:**

- **Rewrote `src/pages/MatchDetail.tsx`** from a placeholder into a full match detail page with three modes:

  **Read-only view:**
  - Opponent emoji + name, date/time, venue with pin icon, format (Bo3/Bo5), overall result colored green/red
  - Game scores as individual cards with game number, scores colored by winner, flame emoji for tight games
  - Tags section showing energy level (with emoji), vibe, and quick tags as pills
  - Match note displayed in a card if present
  - Recommendation text displayed with green left border if present
  - Back navigation arrow in header

  **Edit mode:**
  - "Edit" button toggles into inline edit mode with pre-filled data from the existing match
  - Score editing with +/- buttons (48px touch targets) and quick presets (11-0, 11-5, 11-8, 11-9)
  - Tight game indicator, match result banner, collapsible unneeded games ‚Äî same UX as the log flow
  - Energy level, vibe, quick tags, and note editing ‚Äî reuses same UI patterns from StepTagsSave
  - "Save Changes" overwrites existing match record and re-creates game records
  - "Cancel" returns to read-only view

  **Delete:**
  - "Delete" button shows confirmation dialog: "Delete this match? This cannot be undone."
  - On confirm, deletes match + associated game records and navigates back to Dashboard

- Typecheck, build, and lint all pass
- Committed as `feat: US-013 - Match detail view with edit and delete`
---

## 2026-02-07 - US-014
- What was implemented: Dashboard layout with header stats, current form indicator, insight cards container, match history integration, skeleton loading, and empty state
- Files changed: src/pages/Dashboard.tsx (rewritten from basic match history list to full dashboard)
- **Learnings for future iterations:**
  - Current user found via `players.find(p => p.isCurrentUser)` ‚Äî returns undefined during loading
  - Overall record computed by counting matches with result starting with 'W' vs 'L'
  - Current form indicator shows last 5 results as colored W/L letters (green for win, red for loss)
  - Insight cards container is a `div#insight-cards-container` with `space-y-3` ‚Äî US-015 through US-022 will add cards here
  - Dashboard has 3 loading skeletons: header, insight cards area, match history
  - Empty state shows welcome message with racket emoji and large green CTA button to /log
  - Match history section uses the existing MatchHistoryList component unchanged
---
